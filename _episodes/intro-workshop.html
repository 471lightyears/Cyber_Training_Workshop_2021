<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Jeanette Sperhac" />
  <meta name="date" content="2021-06-14" />
  <title>HPC at CCR, and Intro to OnDemand</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" type="text/css" media="screen, projection, print"
    href="https://www.w3.org/Talks/Tools/Slidy2/styles/slidy.css" />
  <script src="https://www.w3.org/Talks/Tools/Slidy2/scripts/slidy.js"
    charset="utf-8" type="text/javascript"></script>
</head>
<body>
<div class="slide titlepage">
  <h1 class="title">HPC at CCR, and Intro to OnDemand</h1>
  <p class="author">
Jeanette Sperhac
  </p>
  <p class="date">14 June 2021</p>
</div>
<div class="slide section level1">

<!-- : Cybertraining Quantum Chemistry Workshop -->
<!--- pandoc -t slidy -s slides-intro-workshop.md -o slides-intro-slidy.html -->
</div>
<div id="welcome-to-center-for-computational-research-ccr" class="slide section level1">
<h1>Welcome to Center for Computational Research (CCR)</h1>
<div class="columns">
<div class="column" style="width:40%;">
<p><img src="../fig/1_episode/ub-coe.jpg" style="width:100.0%" /></p>
</div><div class="column" style="width:60%;">
<p>We are an academic research computing center at</p>
<p>University at Buffalo,</p>
<p>State University of New York (SUNY),</p>
<p>Buffalo, New York, USA.</p>
</div>
</div>
</div>
<div id="high-performance-computing-hpc-at-ccr" class="slide section level1">
<h1>High-Performance Computing (HPC) at CCR</h1>
<div class="columns">
<div class="column" style="width:50%;">
<p><img src="../fig/1_episode/ccr-machine-room.jpg" style="width:100.0%" /></p>
</div><div class="column" style="width:50%;">
<ul>
<li>CCR houses about 1600 computing <strong>nodes</strong></li>
<li>each node has up to 40 processing <strong>cores</strong> (CPUs)</li>
<li>some have Graphics Processing Units (GPUs)</li>
</ul>
<p>In total, CCR has about 30,000 CPUs (cores).</p>
</div>
</div>
</div>
<div class="slide section level1">

<h2 id="what-makes-hpc-hpc">What makes HPC, HPC?</h2>
<p>Overall high performance computing features:</p>
<ul>
<li>Fast compute</li>
<li>Data storage</li>
<li>Substantial memory</li>
<li>Fast networking</li>
<li>Specialized software</li>
</ul>
</div>
<div class="slide section level1">

<h2 id="fast-compute">Fast compute</h2>
<p>CCR has more than 1 PFlop/second peak performance compute capacity</p>
<pre><code>petaflop/s = one quadrillion floating-point operations per second</code></pre>
<ul>
<li>processor density (up to 40 cores/node)</li>
<li>lots of memory (up to 800 GB/node)</li>
<li>specialized hardware (think GPUs)</li>
<li>specialized architectures (tuned to scientific problems)</li>
</ul>
</div>
<div class="slide section level1">

<h2 id="lots-of-data-storage">Lots of data storage</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p><img src="../fig/1_episode/ccr-machines.jpg" style="width:100.0%" /></p>
</div><div class="column" style="width:60%;">
<p>3+ PB high-performance parallel filesystem</p>
<p>(recall: 1 PB = 2^50 bytes = 1024 terabytes = one million gigabytes)</p>
</div>
</div>
</div>
<div class="slide section level1">

<h2 id="high-performance-networks">High performance networks</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p><img src="../fig/1_episode/wiring-ccr.jpg" style="width:100.0%" /></p>
</div><div class="column" style="width:60%;">
<ul>
<li>fast connections to data storage</li>
<li>fast interconnects between compute nodes</li>
</ul>
</div>
</div>
</div>
<div class="slide section level1">

<!----

## About SLURM

![](../fig/1_episode/slurm-can.jpg){width=20%}

SLURM is our batch scheduler. It's the gatekeeper on the CCR computing resource. 

You tell it what you want to run on:

- how many *cores*?
- how much *memory*?
- for what *duration*?

(Yes, the name is a Futurama reference!)


[About SLURM](https://ubccr.freshdesk.com/support/solutions/articles/5000686927)

-->
<h2 id="about-slurm">About SLURM</h2>
<div class="columns">
<div class="column" style="width:30%;">
<p><img src="../fig/1_episode/slurm-can.jpg" style="width:100.0%" /></p>
<p>(Yes, the name is a Futurama reference!)</p>
</div><div class="column" style="width:70%;">
<p>SLURM (<em>Simple Linux Utility for Resource Management</em>) is batch scheduling software. It’s the gatekeeper on the CCR computing resource.</p>
<p>You tell it about your job’s requirements:</p>
<ul>
<li>how many <em>cores</em>?</li>
<li>how much <em>memory</em>?</li>
<li>for what <em>duration</em>?</li>
</ul>
</div>
</div>
</div>
<div class="slide section level1">

<h2 id="about-slurm-ii">About SLURM II</h2>
<div class="columns">
<div class="column" style="width:30%;">
<p><img src="../fig/1_episode/slurm-can.jpg" style="width:100.0%" /></p>
<p>(Yes, the name is a Futurama reference!)</p>
</div><div class="column" style="width:70%;">
<p>We must also tell SLURM where to run our job:</p>
<ul>
<li>under whose <em>account</em>?</li>
<li>on which <em>cluster</em>?</li>
<li>on which <em>partition</em>?</li>
</ul>
<p>And SLURM schedules your job.</p>
</div>
</div>
</div>
<div class="slide section level1">

<h2 id="ccr-has-three-computing-clusters">CCR has three computing clusters:</h2>
<ul>
<li>general-compute</li>
<li>industry</li>
<li><strong>faculty</strong> (that’s us!)</li>
</ul>
</div>
<div class="slide section level1">

<h2 id="faculty-cluster">Faculty cluster</h2>
<p>On the faculty cluster, we will use the valhalla partition and these parameters:</p>
<pre><code>cluster=faculty

account=cyberwksp21

partition=valhalla

qos=valhalla</code></pre>
<p>See for yourself! On the command line, type: <code>slimits</code></p>
</div>
<div class="slide section level1">

<h2 id="different-ways-to-run">Different ways to run</h2>
<p>We can tell SLURM to run:</p>
<ul>
<li><p><code>sbatch</code>:</p>
<p>schedule a “batch” job when possible</p></li>
<li><p><code>salloc</code>/<code>srun</code>:</p>
<p>schedule the resources with salloc, run interactively with srun</p></li>
</ul>
<h3 id="see-salloc-and-srun-in-action">See <code>salloc</code> and <code>srun</code> in action:</h3>
<p><a href="https://asciinema.org/a/366845">salloc demo</a></p>
</div>
<div class="slide section level1">

<h2 id="monitoring-so-whats-cooking-on-the-cluster">Monitoring: So, what’s cooking on the cluster?</h2>
<p>What may I access on the cluster?</p>
<pre><code>slimits</code></pre>
<p>Show me the faculty cluster status:</p>
<pre><code>sqstat --faculty</code></pre>
<p>Show me valhalla’s <code>allocated</code> nodes:</p>
<pre><code>snodes all faculty/valhalla | grep alloc</code></pre>
<p>output:</p>
<p><img src="../fig/1_episode/snodes.png" style="width:90.0%" /></p>
<!--[snodes documentation](https://ubccr.freshdesk.com/support/solutions/articles/13000076289-snodeshardware-details-about-cluster-nodes)-->
</div>
<div class="slide section level1">

<h2 id="about-ondemand-at-ccr">About OnDemand at CCR</h2>
<p>During the workshop, we will use a web browser and OnDemand to access CCR computing resources. In some cases the negotiation with SLURM happens behind the scenes.</p>
<p><a href="https://ondemand.ccr.buffalo.edu">https://ondemand.ccr.buffalo.edu</a></p>
<p>We will use OnDemand three ways:</p>
<ul>
<li><p><em>Jupyter Notebooks</em></p>
<p>notebooks run on a <code>valhalla</code> compute node</p></li>
<li><p><em>Faculty Cluster App</em></p>
<p>command line access to a <code>valhalla</code> compute node</p></li>
<li><p><em>Faculty Shell</em></p>
<p>command line access to CCR front-end node, <code>vortex</code></p></li>
</ul>
</div>
<div class="slide section level1">

<h2 id="ondemand-at-ccr">OnDemand at CCR</h2>
<p>This is where we begin: <code>https://ondemand.ccr.buffalo.edu</code></p>
<p><img src="../fig/1_episode/ondemand-screenshot.png" style="width:70.0%" /></p>
<!-- 
## Making columns
:::::::::::::: {.columns}
::: {.column width="40%"}
contents...
:::
::: {.column width="60%"}
contents...
:::
::::::::::::::

-->
</div>
<div class="slide section level1">

<!---
## OnDemand Jupyter Notebooks

Schedule a SLURM job that runs a Jupyter session on a `valhalla` compute node:

    Interactive Apps -> Jupyter Notebook Quantum Chemistry

:::::::::::::: {.columns}
::: {.column width="33%"}
1. Start the Interactive App:

![](../fig/1_episode/jupyter-notebook-qc.png){width=100%}
:::
::: {.column width="33%"}
2. Configure the session (Specify SLURM parameters):

![](../fig/1_episode/configure-jupyter-session.png){width=90%}

:::
::: {.column width="33%"}
3. Run Jupyter: 

![](../fig/1_episode/run-jupyter.png){width=100%}
:::
::::::::::::::

--->
<h2 id="ondemand-jupyter-notebooks">OnDemand Jupyter Notebooks</h2>
<p>Schedule a SLURM job that runs a Jupyter session on a <code>valhalla</code> compute node:</p>
<pre><code>Interactive Apps -&gt; Jupyter Notebook Quantum Chemistry</code></pre>
<div class="columns">
<div class="column" style="width:33%;">
<ol style="list-style-type: decimal">
<li>Start the Interactive App:</li>
</ol>
</div><div class="column" style="width:33%;">
<!-- 2. Configure the session (Specify SLURM parameters):

![](../fig/1_episode/configure-jupyter-session.png){width=90%} -->
</div><div class="column" style="width:33%;">
<!-- 3. Run Jupyter: 

![](../fig/1_episode/run-jupyter.png){width=100%} -->
</div>
</div>
<p><img src="../fig/1_episode/jupyter-notebook-qc.png" style="width:70.0%" /></p>
</div>
<div class="slide section level1">

<h2 id="ondemand-jupyter-notebooks-1">OnDemand Jupyter Notebooks</h2>
<p>Schedule a SLURM job that runs a Jupyter session on a <code>valhalla</code> compute node:</p>
<pre><code>Interactive Apps -&gt; Jupyter Notebook Quantum Chemistry</code></pre>
<div class="columns">
<div class="column" style="width:33%;">
<!-- 1. Start the Interactive App: -->
</div><div class="column" style="width:33%;">
<ol start="2" style="list-style-type: decimal">
<li>Configure the session (Specify SLURM parameters):</li>
</ol>
</div><div class="column" style="width:33%;">
<!-- 3. Run Jupyter: 

![](../fig/1_episode/run-jupyter.png){width=100%} -->
</div>
</div>
<p><img src="../fig/1_episode/configure-jupyter-session.png" style="width:70.0%" /></p>
</div>
<div class="slide section level1">

<h2 id="ondemand-jupyter-notebooks-2">OnDemand Jupyter Notebooks</h2>
<p>Schedule a SLURM job that runs a Jupyter session on a <code>valhalla</code> compute node:</p>
<pre><code>Interactive Apps -&gt; Jupyter Notebook Quantum Chemistry</code></pre>
<div class="columns">
<div class="column" style="width:33%;">
<!-- 1. Start the Interactive App: -->
</div><div class="column" style="width:33%;">
<!-- 2. Configure the session (Specify SLURM parameters):-->
</div><div class="column" style="width:33%;">
<ol start="3" style="list-style-type: decimal">
<li>Run Jupyter:</li>
</ol>
</div>
</div>
<p><img src="../fig/1_episode/run-jupyter.png" style="width:70.0%" /></p>
</div>
<div class="slide section level1">

<!--
## OnDemand Faculty Cluster App

Schedule a SLURM job that runs a Linux desktop on a `valhalla` compute node: 

    Interactive Apps -> Faculty Cluster Desktop - Advanced Options


*Share the cores!*

:::::::::::::: {.columns}
::: {.column width="33%"}
1. Start the Interactive App:

![](../fig/1_episode/ood-select-fcd-advanced.png){width=100%}
:::
::: {.column width="33%"}
2. Specify SLURM parameters:

![](../fig/1_episode/ood-options-fcd-advanced.png){width=100%}

:::
::: {.column width="33%"}
3. Run Cluster Desktop: 

![](../fig/1_episode/fcd-running-cluster.png){width=100%}
:::
::::::::::::::

-->
<h2 id="ondemand-faculty-cluster-app">OnDemand Faculty Cluster App</h2>
<p>Schedule a SLURM job that runs a Linux desktop on a <code>valhalla</code> compute node:</p>
<pre><code>Interactive Apps -&gt; Faculty Cluster Desktop - Advanced Options</code></pre>
<p><em>Share the cores!</em></p>
<div class="columns">
<div class="column" style="width:33%;">
<ol style="list-style-type: decimal">
<li>Start the Interactive App:</li>
</ol>
</div><div class="column" style="width:33%;">
<!-- 2. Specify SLURM parameters:

![](../fig/1_episode/ood-options-fcd-advanced.png){width=100%} -->
</div><div class="column" style="width:33%;">
<!--3. Run Cluster Desktop: 

![](../fig/1_episode/fcd-running-cluster.png){width=100%} -->
</div>
</div>
<p><img src="../fig/1_episode/ood-select-fcd-advanced.png" style="width:70.0%" /></p>
</div>
<div class="slide section level1">

<h2 id="ondemand-faculty-cluster-app-1">OnDemand Faculty Cluster App</h2>
<p>Schedule a SLURM job that runs a Linux desktop on a <code>valhalla</code> compute node:</p>
<pre><code>Interactive Apps -&gt; Faculty Cluster Desktop - Advanced Options</code></pre>
<p><em>Share the cores!</em></p>
<div class="columns">
<div class="column" style="width:33%;">
<!--1. Start the Interactive App: -->
</div><div class="column" style="width:33%;">
<ol start="2" style="list-style-type: decimal">
<li>Specify SLURM parameters:</li>
</ol>
</div><div class="column" style="width:33%;">
<!--3. Run Cluster Desktop: 

![](../fig/1_episode/fcd-running-cluster.png){width=100%} -->
</div>
</div>
<p><img src="../fig/1_episode/ood-options-fcd-advanced.png" style="width:70.0%" /></p>
</div>
<div class="slide section level1">

<h2 id="ondemand-faculty-cluster-app-2">OnDemand Faculty Cluster App</h2>
<p>Schedule a SLURM job that runs a Linux desktop on a <code>valhalla</code> compute node:</p>
<pre><code>Interactive Apps -&gt; Faculty Cluster Desktop - Advanced Options</code></pre>
<p><em>Share the cores!</em></p>
<div class="columns">
<div class="column" style="width:33%;">
<!--1. Start the Interactive App: -->
</div><div class="column" style="width:33%;">
<!-- 2. Specify SLURM parameters: -->
</div><div class="column" style="width:33%;">
<ol start="3" style="list-style-type: decimal">
<li>Run Cluster Desktop:</li>
</ol>
</div>
</div>
<p><img src="../fig/1_episode/fcd-running-cluster.png" style="width:70.0%" /></p>
</div>
<div class="slide section level1">

<h2 id="ondemand-faculty-shell">OnDemand Faculty Shell</h2>
<p>Run a command line shell on CCR’s front-end node, <code>vortex</code>:</p>
<pre><code>Clusters -&gt; Faculty Cluster Shell Access</code></pre>
<p>Note: It’s not a running job, just a shell. Use the shell to run a SLURM script, or a modest test (few minutes’ duration, low memory requirements).</p>
<div class="columns">
<div class="column" style="width:50%;">
<ol style="list-style-type: decimal">
<li>Start the shell:</li>
</ol>
<p><img src="../fig/1_episode/ood-select-fcd-advanced.png" style="width:100.0%" /></p>
</div><div class="column" style="width:50%;">
<ol start="2" style="list-style-type: decimal">
<li>Run the shell:</li>
</ol>
<p><img src="../fig/1_episode/faculty-shell.png" style="width:100.0%" /></p>
</div>
</div>
<!-- [Faculty Shell Docs](https://ubccr.freshdesk.com/support/solutions/articles/13000072839-ondemand-cluster-app) -->
</div>
<div class="slide section level1">

<h2 id="view-your-active-jobs">View your active jobs</h2>
<p>View jobs you are running right now:</p>
<pre><code>Jobs -&gt; Active Jobs</code></pre>
<div class="columns">
<div class="column" style="width:50%;">
<ol style="list-style-type: decimal">
<li>View in OnDemand:</li>
</ol>
<p><img src="../fig/1_episode/ood-active-jobs.png" style="width:100.0%" /></p>
</div><div class="column" style="width:50%;">
<ol start="2" style="list-style-type: decimal">
<li>Or run <code>squeue -u $USER</code> in a terminal:</li>
</ol>
<p><img src="../fig/1_episode/squeue-in-ood.png" style="width:100.0%" /></p>
</div>
</div>
</div>
<div class="slide section level1">

<h2 id="troubleshoot-and-debug">Troubleshoot and debug</h2>
<p>View your OnDemand sessions (Click on the box icon, <code>My Interactive Sessions</code>):</p>
<p><img src="../fig/1_episode/ood-interactive-sessions.png" style="width:60.0%" /></p>
</div>
<div class="slide section level1">

<h2 id="troubleshoot-and-debug-zoom-in-on-one-session">Troubleshoot and debug: zoom in on one session</h2>
<p>For each session we see useful information:</p>
<ul>
<li><p>Note the hostname where the job is running, <code>cpn-p27-15</code></p></li>
<li><p>You can click <code>Session ID</code> to access session log files</p></li>
</ul>
<p><img src="../fig/1_episode/faculty-cluster-desktop-advanced-running.png" style="width:50.0%" /></p>
</div>
<div class="slide section level1">

<h2 id="files-app">Files app</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p><img src="../fig/1_episode/files-app-edit-jms.png" style="width:100.0%" /></p>
</div><div class="column" style="width:40%;">
<p>Use the OnDemand Files app (e.g. <code>Files -&gt; Home Directory</code>) for:</p>
<ul>
<li>Browsing directories</li>
<li>Upload files</li>
<li>Download files</li>
<li>Simple file edits*</li>
</ul>
</div>
</div>
<p>* Potentially</p>
</div>
<div class="slide section level1">

<h2 id="editing-your-files">Editing your files</h2>
<p>You have multiple options for file editor:</p>
<ul>
<li>OnDemand Files app* (simplest)</li>
<li><code>nano</code> (easy)</li>
<li><code>vi</code> (just right)</li>
<li><code>emacs</code> (grrr)</li>
</ul>
<p>* Potentially</p>
</div>
<div class="slide section level1">

<h2 id="contact-us">Contact us</h2>
<p>Have a question, comment, or issue?</p>
<ul>
<li><p>Join us on the workshop Slack channel:</p>
<p>quantumdynamicshub.slack.com</p></li>
<li><p>Check the <a href="TODO">CCR documentation</a></p></li>
<li><p>Enter a CCR help ticket:</p>
<p>email: <code>ccr-help@buffalo.edu</code></p>
<p>webpage: <a href="https://ubccr.freshdesk.com/support/home">https://ubccr.freshdesk.com/</a></p></li>
</ul>
</div>
</body>
</html>
